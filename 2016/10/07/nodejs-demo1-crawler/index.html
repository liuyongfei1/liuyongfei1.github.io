<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta http-equiv=”Cache-Control” content=”no-transform” />
<meta http-equiv=”Cache-Control” content=”no-siteapp” />


  <meta name="keywords" content=" ,nodejs,http模块,cheerio模块,http小爬虫, " />



    <meta name="description" content="从零开始nodejs系列之案例一：HTTP小爬虫, Rome was not built in a day!" />


















  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.2"/>





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.2" />


  <title> 从零开始nodejs系列之案例一：HTTP小爬虫 - PHPING|记录工作中的点点滴滴 </title>
</head>

<body>
<!--[if lte IE 8]> <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'> <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://static.ixirong.com/picouterie.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari." style='margin-left:auto;margin-right:auto;display: block;'/></a></div> <![endif]-->
  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <div id="header" class="header">

    <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>
    <script type="text/javascript">
  function hasMobileUA () {
    var nav = window.navigator;
    var ua = nav.userAgent;
    var pa = /iPad|micromessenger|iPhone|Android|Opera Mini|BlackBerry|webOS|UCWEB|UCBrowser|MQQBrowser|Blazer|PSP|IEMobile|Symbian|Mobile|samsung|htc/g;
    return pa.test(ua);
  }

  function isDesktop () {
    return screen.width > 991 && !hasMobileUA();
  }

  function isTablet () {
    return screen.width < 992 && screen.width > 767 && hasMobileUA();
  }

  function isMobile () {
    return screen.width < 767 && hasMobileUA();
  }

  function escapeSelector (selector) {
    return selector.replace(/[!"$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g, "\\$&")
  }

  function displaySidebar () {
    setTimeout(function () {
      $('.sidebar-toggle').trigger('click');
    }, 800);
  }

</script>


      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">PHPING|记录工作中的点点滴滴</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>


  <ul id="menu" class="menu">
    <div class="c-search-form-div" style="display:none;">
      
      <form class="menu-item" >
        <input type="text" id="ts-search-input" class="menu-search-input st-default-search-input"  />
      </form>
      
        <script type="text/javascript">
         (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
        (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
        e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
         })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

        _st('install','umye5GiPnBwRp_kCfRyB','2.0.0');
        </script>  
      
      
    </div>
    <script type="text/javascript">
      if(isDesktop() || isTablet()){        
        $('.c-search-form-div').css("display","inline");
      }    
    </script>

    
      
      
        <li class="menu-item menu-item-about">
        <a href="/about">
          <i class="menu-item-icon icon-about"></i> <br />
          关于
        </a>
      </li>
      
    
      
      
        <li class="menu-item menu-item-tags">
        <a href="/tags">
          <i class="menu-item-icon icon-tags"></i> <br />
          标签
        </a>
      </li>
      
    
      
      
        <li class="menu-item menu-item-categories">
        <a href="/categories">
          <i class="menu-item-icon icon-categories"></i> <br />
          分类
        </a>
      </li>
      
    
      
      
        <li class="menu-item menu-item-archives">
        <a href="/archives">
          <i class="menu-item-icon icon-archives"></i> <br />
          归档
        </a>
      </li>
      
    
      
      
        <li class="menu-item menu-item-commonweal" style="display:none;">
        <a href="/404.html">
          <i class="menu-item-icon icon-commonweal"></i> <br />
          公益404
        </a>
      </li>
      
    

    <script type="text/javascript">
      if(!isMobile()){
         $('.menu-item-commonweal').css("display","");
      }
    </script>

  </ul>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          

  <div id="posts" class="posts-expand">
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              从零开始nodejs系列之案例一：HTTP小爬虫
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2016-10-06
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="/categories/nodejs/">nodejs</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2016/10/07/nodejs-demo1-crawler/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/07/nodejs-demo1-crawler/"></span>
            </a>
          </span>
          
        

        
        
        	 <span id="/2016/10/07/nodejs-demo1-crawler/"class="leancloud_visitors"  data-flag-title="从零开始nodejs系列之案例一：HTTP小爬虫">
                &nbsp; | &nbsp; 阅读次数
                </span>
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        <h1 id="一-前言"><a href="#一-前言" class="headerlink" title="一.前言"></a>一.前言</h1><blockquote>
<p>漫漫长路，从脚下开始；<br>那么就从一个一个案例开始吧，在这个叫做blog的地方做为笔记记录下来。。。</p>
</blockquote>
<h2 id="二-案例一：HTTP小爬虫"><a href="#二-案例一：HTTP小爬虫" class="headerlink" title="二.案例一：HTTP小爬虫"></a>二.案例一：HTTP小爬虫</h2><h3 id="1-从零开始nodejs系列之案例一：HTTP小爬虫"><a href="#1-从零开始nodejs系列之案例一：HTTP小爬虫" class="headerlink" title="1. 从零开始nodejs系列之案例一：HTTP小爬虫"></a>1. 从零开始nodejs系列之案例一：HTTP小爬虫</h3><p>本案例用来抓取<strong>慕课网的nodejs课程列表</strong>,如下：</p>
<p><img src="/images/2016-09-25/QQ20160925-0@2x.png" alt="QQ20160925-0@2x.png"></p>
<h3 id="2-爬虫抓取结果如下："><a href="#2-爬虫抓取结果如下：" class="headerlink" title="2.爬虫抓取结果如下："></a>2.爬虫抓取结果如下：</h3><p><img src="/images/2016-09-25/QQ20160925-1@2x.png" alt="QQ20160925-1@2x.png"><br><strong>注意：</strong>篇幅所限，这里我就截取了前三章的课程列表。<br><a id="more"></a></p>
<h2 id="三-HTTP模块"><a href="#三-HTTP模块" class="headerlink" title="三.HTTP模块"></a>三.HTTP模块</h2><p>在讲HTTP小爬虫之前，先来大概介绍一下HTTP模块。<br>关于HTTP的api，<a href="http://nodejs.cn/doc/node/http.html" target="_blank" rel="external">点这里</a>，我这里就不一一列出来了。让我们从一个简单的例子开始。</p>
<h3 id="1-需求"><a href="#1-需求" class="headerlink" title="1.需求"></a>1.需求</h3><p>   <strong>目的：建立一个lesson项目，通过在其中编写代码，当在浏览器中访问：http:://localhost:3000时，输出：Hello World</strong><br>   代码如下：<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">const http = require(&apos;http&apos;);</div><div class="line"></div><div class="line">const hostname = &apos;127.0.0.1&apos;;</div><div class="line">const port = 3000;</div><div class="line"></div><div class="line">const server = http.createServer((req, res) =&gt; &#123;</div><div class="line">  res.statusCode = 200;</div><div class="line">  res.setHeader(&apos;Content-Type&apos;, &apos;text/plain&apos;);</div><div class="line">  res.end(&apos;Hello World\n&apos;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">server.listen(port, hostname, () =&gt; &#123;</div><div class="line">  console.log(`Server running at http://$&#123;hostname&#125;:$&#123;port&#125;/`);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>   在命令行中执行:<br>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ node server.js</div></pre></td></tr></table></figure></p>
<p>   浏览器访问：<br>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://localhost:3000/</div></pre></td></tr></table></figure></p>
<p>   即可看到输出结果：<br>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ Hello World</div></pre></td></tr></table></figure></p>
<h3 id="2-代码分析："><a href="#2-代码分析：" class="headerlink" title="2.代码分析："></a>2.代码分析：</h3><ol>
<li>通过”require”引入NodeJS自带的”http”模块，并且把它赋值给http变量;</li>
<li><p>“requestListener”这个回调函数，它提供了两个参数（request，response），我在代码里分别简写为req,res。每次收到一个请求时触发。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http.createServer([requestListener])</div></pre></td></tr></table></figure>
<blockquote>
<p>返回一个新的web服务器对象。参数 requestListener 是一个函数,它将会自动加入到 ‘request’ 事件的监听队列.</p>
</blockquote>
</li>
<li><p>statusCode是一个三位的HTTP状态码, 例如：”404” 。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">response.statusCode = 404;</div></pre></td></tr></table></figure>
<blockquote>
<p>当使用默认headers时（没有显式地调用 response.writeHead() 来修改headers），这个属性决定headers更新时被传回客户端的HTTP状态码。</p>
</blockquote>
</li>
<li><p>setHeader</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">response.setHeader(name, value)</div></pre></td></tr></table></figure>
<blockquote>
<p>为默认或者已存在的头设置一条单独的头内容。如果这个头已经存在于 将被送出的头中，将会覆盖原来的内容。如果我想设置更多的头， 就使用一个相同名字的字符串数组</p>
</blockquote>
</li>
<li>server.listen(port, [hostname], [backlog], [callback])<blockquote>
<p>开始在指定的主机名和端口接收连接。如果省略主机名，服务器会接收指向任意IPv4地址的链接（INADDR_ANY）。</p>
</blockquote>
</li>
</ol>
<h2 id="四-cheerio模块"><a href="#四-cheerio模块" class="headerlink" title="四.cheerio模块"></a>四.cheerio模块</h2><blockquote>
<p>抓取到网页之后如何获取到想要的数据呢？然后就发现了cheerio，用来解析html非常方便，就像在浏览器中使用jquery一样；<br>为服务器特别定制的，快速、灵活、实施的jQuery核心实现。</p>
</blockquote>
<p>github项目地址点<a href="https://github.com/cheeriojs/cheerio" target="_blank" rel="external">这里</a>。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install cheerio</div></pre></td></tr></table></figure>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a><a href="https://github.com/cheeriojs/cheerio" target="_blank" rel="external">API</a></h2><p>我们再来看<a href="https://github.com/cheeriojs/cheerio" target="_blank" rel="external">cheerio的API</a>举的例子</p>
<h3 id="Markup-example-we’ll-be-using"><a href="#Markup-example-we’ll-be-using" class="headerlink" title="Markup example we’ll be using:"></a>Markup example we’ll be using:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;ul id=<span class="string">"fruits"</span>&gt;</div><div class="line">  &lt;li class=<span class="string">"apple"</span>&gt;Apple&lt;/li&gt;</div><div class="line">  &lt;li class=<span class="string">"orange"</span>&gt;Orange&lt;/li&gt;</div><div class="line">  &lt;li class=<span class="string">"pear"</span>&gt;Pear&lt;/li&gt;</div><div class="line">&lt;/ul&gt;</div></pre></td></tr></table></figure>
<h3 id="Loading"><a href="#Loading" class="headerlink" title="Loading"></a>Loading</h3><p>First you need to load in the HTML. This step in jQuery is implicit, since jQuery operates on the one, baked-in DOM. With Cheerio, we need to pass in the HTML document.<br>This is the preferred method:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var cheerio = require(<span class="string">'cheerio'</span>),</div><div class="line">$ = cheerio.load(<span class="string">'&lt;ul id="fruits"&gt;...&lt;/ul&gt;'</span>);</div></pre></td></tr></table></figure></p>
<h3 id="Selectors"><a href="#Selectors" class="headerlink" title="Selectors"></a>Selectors</h3><p>Cheerio’s selector implementation is nearly identical to jQuery’s, so the API is very similar.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'.apple'</span>, <span class="string">'#fruits'</span>).text()</div><div class="line">//=&gt; Apple</div><div class="line"></div><div class="line">$(<span class="string">'ul .pear'</span>).attr(<span class="string">'class'</span>)</div><div class="line">//=&gt; pear</div><div class="line"></div><div class="line">$(<span class="string">'li[class=orange]'</span>).html()</div><div class="line">//=&gt; Orange</div></pre></td></tr></table></figure></p>
<h3 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h3><p>Methods for getting and modifying attributes.</p>
<h4 id="attr-name-value"><a href="#attr-name-value" class="headerlink" title=".attr( name, value )"></a>.attr( name, value )</h4><p>Method for getting and setting attributes. Gets the attribute value for only the first element in the matched set. If you set an attribute’s value to null, you remove that attribute. You may also pass a map and function like jQuery.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'ul'</span>).attr(<span class="string">'id'</span>)</div><div class="line">//=&gt; fruits</div><div class="line"></div><div class="line">$(<span class="string">'.apple'</span>).attr(<span class="string">'id'</span>, <span class="string">'favorite'</span>).html()</div><div class="line">//=&gt; &lt;li class=<span class="string">"apple"</span> id=<span class="string">"favorite"</span>&gt;Apple&lt;/li&gt;</div></pre></td></tr></table></figure></p>
<h2 id="再看一个小demo"><a href="#再看一个小demo" class="headerlink" title="再看一个小demo"></a>再看一个小demo</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var cheerio = require(<span class="string">'cheerio'</span>)</div><div class="line">$ = cheerio.load(<span class="string">'&lt;h2 class="title"&gt;Hello world&lt;/h2&gt;'</span>)</div><div class="line">$(<span class="string">'h2.title'</span>).text(<span class="string">'Hello there!'</span>)</div><div class="line">$(<span class="string">'h2'</span>).addClass(<span class="string">'welcome'</span>)</div><div class="line">console.log($.html());</div></pre></td></tr></table></figure>
<h3 id="输出"><a href="#输出" class="headerlink" title="输出:"></a>输出:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;h2 class=<span class="string">"title welcome"</span>&gt;Hello there!&lt;/h2&gt;</div></pre></td></tr></table></figure>
<p>等等，我就不再一一贴出来了，大家看一些这些语法，是不是就跟jquery的语法差不多呢。。。</p>
<p>HTTP模块和cheerio模块已经做了简单的介绍，详细的使用大家可以翻阅对应的API。<br><strong>好，准备工作也做得差不多了，让我们步入正题，开始来做HTTP爬虫吧。</strong></p>
<hr>
<h1 id="HTTP爬虫所需模块"><a href="#HTTP爬虫所需模块" class="headerlink" title="HTTP爬虫所需模块"></a>HTTP爬虫所需模块</h1><ul>
<li>HTTP模块: 既然是HTTP小爬虫，肯定需要HTTP模块.</li>
<li>cheerio模块: 抓取到网页之后如何获取到想要的数据,这个时候就需要cheerio，用来解析html非常方便，就像在浏览器中使用jquery一样。</li>
</ul>
<p>==开始摞码:==</p>
<h3 id="一-代码区1"><a href="#一-代码区1" class="headerlink" title="一.代码区1"></a>一.代码区1</h3><p>加载所需模块</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var http = require(<span class="string">'http'</span>)</div><div class="line">var cheerio = require(<span class="string">'cheerio'</span>)</div><div class="line">var url = <span class="string">'http://www.imooc.com/learn/348'</span>;</div></pre></td></tr></table></figure>
<h4 id="代码解释"><a href="#代码解释" class="headerlink" title="代码解释"></a>代码解释</h4><ol>
<li>加载http模块;</li>
<li>加载cheerio模块;</li>
<li>指定要抓取的地址;</li>
</ol>
<h3 id="二-代码区2"><a href="#二-代码区2" class="headerlink" title="二.代码区2"></a>二.代码区2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">http.get(url,<span class="keyword">function</span>(res) &#123;</div><div class="line">  var html = <span class="string">''</span>;</div><div class="line">  res.on(<span class="string">'data'</span>,<span class="keyword">function</span>(data) &#123;</div><div class="line">    html += data</div><div class="line">  &#125;)</div><div class="line">  res.on(<span class="string">'end'</span>,<span class="function"><span class="title">function</span></span>() &#123;</div><div class="line">    var courseData = filterChapters(html)</div><div class="line">    <span class="built_in">print</span>CourseInfo(courseData)</div><div class="line">  &#125;)</div><div class="line">&#125;).on(<span class="string">'error'</span>,<span class="function"><span class="title">function</span></span>() &#123;</div><div class="line">  console.log(<span class="string">'出错了哦'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h4 id="代码解释-1"><a href="#代码解释-1" class="headerlink" title="代码解释"></a>代码解释</h4><h4 id="http-get-options-callback"><a href="#http-get-options-callback" class="headerlink" title="http.get(options, callback)"></a>http.get(options, callback)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">因为大部分的请求是没有报文体的GET请求，所以Node提供了这种便捷的方法。</div><div class="line">该方法与http.request()的唯一区别是它设置的是GET方法并自动调用req.end()。</div></pre></td></tr></table></figure>
<p>http.request的用例如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">// make a request</div><div class="line">  var options = &#123;</div><div class="line">    port: 1337,</div><div class="line">    hostname: <span class="string">'127.0.0.1'</span>,</div><div class="line">    headers: &#123;</div><div class="line">      <span class="string">'Connection'</span>: <span class="string">'Upgrade'</span>,</div><div class="line">      <span class="string">'Upgrade'</span>: <span class="string">'websocket'</span></div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  var req = http.request(options);</div><div class="line">  req.end();</div></pre></td></tr></table></figure></p>
<h4 id="response-end"><a href="#response-end" class="headerlink" title="response.end"></a>response.end</h4><blockquote>
<p>结束响应，告诉客户端所有消息已经发送。当所有要返回的内容发送完毕时，该函数必须被调用一次。<br>如何不调用该函数，客户端将永远处于等待状态。</p>
</blockquote>
<h4 id="filterChapters函数"><a href="#filterChapters函数" class="headerlink" title="filterChapters函数"></a>filterChapters函数</h4><p>filterChapters函数为封装好的过滤html的函数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> filterChapters(html) &#123;</div><div class="line">  var $ = cheerio.load(html)</div><div class="line">  var charpters = $(<span class="string">'.chapter'</span>)</div><div class="line">  var courseData = []</div><div class="line">  charpters.each(<span class="keyword">function</span>(item) &#123;</div><div class="line">    var chapter =  $(this)</div><div class="line"></div><div class="line">    var chapterTmpTitle = chapter.find(<span class="string">'strong'</span>).clone()</div><div class="line">    chapterTmpTitle.find(<span class="string">'div'</span>).remove()</div><div class="line"></div><div class="line">    // var chapterTitle = chapter.find(<span class="string">'strong'</span>).text()</div><div class="line">    var chapterTitle = chapterTmpTitle.text().match(/\S+\s\S+/)</div><div class="line">    var videos = chapter.find(<span class="string">'.video'</span>).children(<span class="string">'li'</span>)</div><div class="line">    var chapterData = &#123;</div><div class="line">      chapterTitle: chapterTitle,</div><div class="line">      videos: []</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    videos.each(<span class="keyword">function</span>(item) &#123;</div><div class="line">      var video = $(this).find(<span class="string">'.J-media-item'</span>)</div><div class="line">      var videoTmpTitle = video.clone()</div><div class="line">      videoTmpTitle.find(<span class="string">'button'</span>).remove()</div><div class="line">      var videoTitle = videoTmpTitle.text().match(/[0-9]+-[0-9]+\s\S*\s?\S*/)</div><div class="line">      // console.log(chapterTitle)</div><div class="line">      // var videoTitle = video.text()</div><div class="line">      var id = video.attr(<span class="string">'href'</span>).split(<span class="string">'video/'</span>)[1]</div><div class="line">      chapterData.videos.push(&#123;</div><div class="line">        title : videoTitle,</div><div class="line">        id: id</div><div class="line">      &#125;)</div><div class="line">    &#125;)</div><div class="line">    courseData.push(chapterData)</div><div class="line">  &#125;)</div><div class="line">  <span class="built_in">return</span> courseData</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="printCourseInfo函数"><a href="#printCourseInfo函数" class="headerlink" title="printCourseInfo函数"></a>printCourseInfo函数</h4><p>printCourseInfo函数用来打印课程信息的函数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> <span class="built_in">print</span>CourseInfo(courseData) &#123;</div><div class="line">  courseData.forEach(<span class="keyword">function</span>(item) &#123;</div><div class="line">    var chapterTitle = item.chapterTitle</div><div class="line">    console.log(chapterTitle + <span class="string">'\n'</span>)</div><div class="line">    item.videos.forEach(<span class="keyword">function</span>(video) &#123;</div><div class="line">      console.log(<span class="string">' 【'</span> + video.id + <span class="string">' 】'</span> + video.title + <span class="string">'\n'</span>)</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>好了，主要代码大概就是这些。</p>

      
    </div>

    <div class="post-footer">

<! -- 添加捐赠图标 -->
    
    

    <div class ="post-donate">
      <div id="donate_board" class="donate_bar center" style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;font-size:14px">
        <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
        <a id="btn_donate" class="btn_donate" href="javascript:;" title="Donate 打赏"></a>
        <span class="donate_txt">
           &uarr;<br>
           
            Enjoy it ? Donate me !  欣赏此文？求鼓励，求支持！
           
        </span>
        <br>
      </div>

      <div id="donate_guide" class="donate_bar center hidden">
        
          <a href="/images/alipay.png" title="支付宝打赏" class="fancybox" rel="article0"       style="float:left;margin-left:25%;margin-right:2px;">
          <img src="/images/alipay.png" title="支付宝打赏" height="164px" width="164px">
          </a>
        

      
       <a href="/images/weixinpay.png" title="微信打赏" class="fancybox" rel="article0">
         <img src="/images/weixinpay.png" title="微信打赏" height="164px" width="164px">
       </a>
      

      </div>

      <script type="text/javascript">
        document.getElementById('btn_donate').onclick = function(){
          $('#donate_board').addClass('hidden');
          $('#donate_guide').removeClass('hidden');
        }
      </script>
    </div>

    

<! -- end 添加捐赠图标 -->
      
        <div class="post-tags">
          
            <a href="/tags/nodejs/"> #nodejs </a>
          
            <a href="/tags/http模块/"> #http模块 </a>
          
            <a href="/tags/cheerio模块/"> #cheerio模块 </a>
          
            <a href="/tags/http小爬虫/"> #http小爬虫 </a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/10/16/nodejs-fs/">nodejs之文件操作(fs模块)</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/09/21/echarts-line-drill-down-code/">手把手教你实现echarts3的折线图下钻drilldown功能系列篇二</a>
            
          </div>
        </div>
      

      
      
    </div>
  </div>



    
      <div class="comments" id="comments">
        

<div class="ds-share" data-thread-key="2016/10/07/nodejs-demo1-crawler/" data-title="从零开始nodejs系列之案例一：HTTP小爬虫" data-images="http://phping1.github.io/2016/10/07/nodejs-demo1-crawler/" data-content="http://phping1.github.io/2016/10/07/nodejs-demo1-crawler/" data-url="http://phping1.github.io/2016/10/07/nodejs-demo1-crawler/">
    <div class="ds-share-inline">
      <ul  class="ds-share-icons-16">
        <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
        <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
        <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
        <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      </ul>
      <div class="ds-share-icons-more">
      </div>
    </div>
 </div>

          <!-- 评论框 -->
          <div class="ds-thread" data-thread-key="2016/10/07/nodejs-demo1-crawler/"
               data-title="从零开始nodejs系列之案例一：HTTP小爬虫" data-url="http://phping1.github.io/2016/10/07/nodejs-demo1-crawler/">
          </div>
        
      </div>
    
  </div>



          

          
        </div>
      </div>


      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview">
        <div class="site-author motion-element">
          <img class="site-author-image" src="/images/phping.png" alt="PHPING" />
          <p class="site-author-name">PHPING</p>
        </div>
        <p class="site-description motion-element">Rome was not built in a day!</p>
        <div class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">11</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">2</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">21</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>
        </div>

        

        <div class="links-of-author motion-element">
          
              
                <span class="links-of-author-item">
                  <a href="http://weibo.com/1797633405/profile?topnav=1&wvr=6&is_all=1" target="_blank" title="微博">
                    
                      <i class="fa fa-fw fa-weibo"></i>
                    
                    微博
                  </a>
              </span>
              
                <span class="links-of-author-item">
                  <a href="https://github.com/phping1" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>
                    
                    GitHub
                  </a>
              </span>
              
                <span class="links-of-author-item">
                  <a href="https://segmentfault.com/u/phping" target="_blank" title="segmentfault">
                    
                      <i class="fa fa-fw fa-globe"></i>
                    
                    segmentfault
                  </a>
              </span>
              
          
        </div>

        
        


        
          <div class="links-of-author motion-element">
          <p class="site-author-name">LINKS</p>
            
              <span class="links-of-author-item">
              <a href="http://www.ruanyifeng.com/blog/" target="_blank">阮一峰</a>
              </span>
            
              <span class="links-of-author-item">
              <a href="http://coolshell.cn/" target="_blank">酷壳</a>
              </span>
            
              <span class="links-of-author-item">
              <a href="http://phping.sinaapp.com/" target="_blank">SaeBlog</a>
              </span>
            
          </div>
        

      </div>

      
        <div class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#一-前言"><span class="nav-number">1.</span> <span class="nav-text">一.前言</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#二-案例一：HTTP小爬虫"><span class="nav-number">1.1.</span> <span class="nav-text">二.案例一：HTTP小爬虫</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-从零开始nodejs系列之案例一：HTTP小爬虫"><span class="nav-number">1.1.1.</span> <span class="nav-text">1. 从零开始nodejs系列之案例一：HTTP小爬虫</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-爬虫抓取结果如下："><span class="nav-number">1.1.2.</span> <span class="nav-text">2.爬虫抓取结果如下：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三-HTTP模块"><span class="nav-number">1.2.</span> <span class="nav-text">三.HTTP模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-需求"><span class="nav-number">1.2.1.</span> <span class="nav-text">1.需求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-代码分析："><span class="nav-number">1.2.2.</span> <span class="nav-text">2.代码分析：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四-cheerio模块"><span class="nav-number">1.3.</span> <span class="nav-text">四.cheerio模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装"><span class="nav-number">1.4.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#API"><span class="nav-number">1.5.</span> <span class="nav-text">API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Markup-example-we’ll-be-using"><span class="nav-number">1.5.1.</span> <span class="nav-text">Markup example we’ll be using:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Loading"><span class="nav-number">1.5.2.</span> <span class="nav-text">Loading</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Selectors"><span class="nav-number">1.5.3.</span> <span class="nav-text">Selectors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Attributes"><span class="nav-number">1.5.4.</span> <span class="nav-text">Attributes</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#attr-name-value"><span class="nav-number">1.5.4.1.</span> <span class="nav-text">.attr( name, value )</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#再看一个小demo"><span class="nav-number">1.6.</span> <span class="nav-text">再看一个小demo</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#输出"><span class="nav-number">1.6.1.</span> <span class="nav-text">输出:</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HTTP爬虫所需模块"><span class="nav-number">2.</span> <span class="nav-text">HTTP爬虫所需模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一-代码区1"><span class="nav-number">2.0.1.</span> <span class="nav-text">一.代码区1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#代码解释"><span class="nav-number">2.0.1.1.</span> <span class="nav-text">代码解释</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二-代码区2"><span class="nav-number">2.0.2.</span> <span class="nav-text">二.代码区2</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#代码解释-1"><span class="nav-number">2.0.2.1.</span> <span class="nav-text">代码解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#http-get-options-callback"><span class="nav-number">2.0.2.2.</span> <span class="nav-text">http.get(options, callback)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#response-end"><span class="nav-number">2.0.2.3.</span> <span class="nav-text">response.end</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#filterChapters函数"><span class="nav-number">2.0.2.4.</span> <span class="nav-text">filterChapters函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#printCourseInfo函数"><span class="nav-number">2.0.2.5.</span> <span class="nav-text">printCourseInfo函数</span></a></li></ol></li></ol></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </div>
      
    </div>

  </div>


    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp;  2012 - 
  2017

  <span class="author"> PHPING</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io" rel="external nofollow">Hexo</a> 
</div>

<div class="theme-info">
  Clone theme
  <a class="theme-link" href="https://github.com/xirong/hexo-theme-next" rel="external nofollow">
    NexT
  </a>
</div>





      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <!-- <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script> -->

  
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $('.content img').each(function () {
        var $image = $(this);
        var $imageWrapLink = $image.parent('a');

        if ($imageWrapLink.size() < 1) {
          $imageWrapLink = $image.wrap('<a href="' + this.getAttribute('src') + '"></a>').parent('a');
        }
        $imageWrapLink.addClass('fancybox');
      });
    });
    $('.fancybox').fancybox({
      helpers: {
        overlay: {
          locked: false
        }
      }
    });
  </script>


  <!-- <script type="text/javascript">
  function hasMobileUA () {
    var nav = window.navigator;
    var ua = nav.userAgent;
    var pa = /iPad|micromessenger|iPhone|Android|Opera Mini|BlackBerry|webOS|UCWEB|UCBrowser|MQQBrowser|Blazer|PSP|IEMobile|Symbian|Mobile|samsung|htc/g;
    return pa.test(ua);
  }

  function isDesktop () {
    return screen.width > 991 && !hasMobileUA();
  }

  function isTablet () {
    return screen.width < 992 && screen.width > 767 && hasMobileUA();
  }

  function isMobile () {
    return screen.width < 767 && hasMobileUA();
  }

  function escapeSelector (selector) {
    return selector.replace(/[!"$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g, "\\$&")
  }

  function displaySidebar () {
    setTimeout(function () {
      $('.sidebar-toggle').trigger('click');
    }, 800);
  }

</script>
 -->
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" id="motion.global">
  $(document).ready(function () {
    var body = $('body');

    var isSidebarVisible = false;
    var sidebarToggle = $('.sidebar-toggle');
    var sidebarToggleLine1st = $('.sidebar-toggle-line-first')
    var sidebarToggleLine2nd = $('.sidebar-toggle-line-middle');
    var sidebarToggleLine3rd = $('.sidebar-toggle-line-last');
    var sidebar = $('.sidebar');

    var SIDEBAR_WIDTH = '320px';
    var SIDEBAR_DISPLAY_DURATION = 300;

    var sidebarToogleLineStatusInit = {width: '100%', opacity: 1, left: 0, rotateZ: 0, top: 0};

    var sidebarToggleLine1stStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine1stStatusArrow = {width: '50%', rotateZ: '-45deg', top: '2px'};
    var sidebarToogleLine1stStatusClose = {width: '100%', rotateZ: '-45deg', top: '5px'};

    var sidebarToggleLine2ndStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine2ndStatusArrow = {width: '90%'};
    var sidebarToogleLine2ndStatusClose = {opacity: 0};

    var sidebarToggleLine3rdStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine3rdStatusArrow = {width: '50%', rotateZ: '45deg', top: '-2px'};
    var sidebarToogleLine3rdStatusClose = {width: '100%', rotateZ: '45deg', top: '-5px'};

    LogoAndMenuMotion();
    sidebarToggleMotion();
    postsListMotion();
    backToTopMotion();    

    $(document)
      .on('sidebar.isShowing', function () {
        isDesktop() && body.velocity(
          {paddingRight: SIDEBAR_WIDTH},
          SIDEBAR_DISPLAY_DURATION
        );
        sidebarContentMotion();
      })
      .on('sidebar.isHiding', function () {});

//search animate
$(function(){
   $('#ts-search-input').focus(function() {  //设置获得焦点时的方法，让文本框变长
    $(this).animate({width: "150"}, 300 );  
    $(this).val(''); //用于清空内容，可选操作
   });
 
   $('#ts-search-input').blur(function() {  //设置失去焦点时的方法，让文本框变短
    $(this).animate({width: "70"}, 300 );
   });
});

    function LogoAndMenuMotion() {
      $.Velocity.RunSequence([
        { e: $('.brand'), p: { opacity: 1 }, o: { duration: 100 } },
        { e: $('.logo'), p: { opacity: 1, top: 0 }, o: { duration: 50} },
        
        { e: $('.logo-line-before i'), p: { translateX: "100%" }, o: { duration: 500, sequenceQueue: false } },
        { e: $('.logo-line-after i'), p: { translateX: "-100%" }, o: { duration: 500, sequenceQueue: false } },
        
        { e: $('.site-title'), p: { opacity: 1, top: 0 }, o: { duration: 200 } }
      ]);
      $('.menu-item').velocity('transition.slideDownIn', {display: null});
    }


    function backToTopMotion () {
      var b2top = $('.back-to-top');
      b2top.on('click', function () {
        body.velocity('scroll');
      });
    }

    function sidebarShowMotion () {

      sidebarToggleLine1st.velocity(sidebarToogleLine1stStatusClose);
      sidebarToggleLine2nd.velocity(sidebarToogleLine2ndStatusClose);
      sidebarToggleLine3rd.velocity(sidebarToogleLine3rdStatusClose);

      sidebar.velocity({width: SIDEBAR_WIDTH}, {
        display: 'block',
        duration: SIDEBAR_DISPLAY_DURATION,
        complete: function () {
          sidebar.addClass('sidebar-active');
          sidebar.trigger('sidebar.didShow');
        }
      });
      sidebar.trigger('sidebar.isShowing');
    }

    function sidebarHideMotion () {
      isDesktop() && body.velocity({paddingRight: 0});
      sidebar.velocity('reverse');

      sidebarToggleLine1st.velocity(sidebarToggleLine1stStatusInit);
      sidebarToggleLine2nd.velocity(sidebarToggleLine2ndStatusInit);
      sidebarToggleLine3rd.velocity(sidebarToggleLine3rdStatusInit);

      sidebar.removeClass('sidebar-active');
      sidebar.trigger('sidebar.isHiding');
    };

    function sidebarContentMotion () {
      $('.sidebar .motion-element').velocity(
        'transition.slideRightIn',
        {stagger: 50, drag: true}
      );
    }

    function postsListMotion () {
      var postMotionOptions = window.postMotionOptions || {stagger: 300, drag: true};
      $('.post').velocity('transition.slideDownIn', postMotionOptions);
    }

    function sidebarToggleMotion () {
      sidebarToggle.on('click', function () {
        isSidebarVisible ? sidebarHideMotion() : sidebarShowMotion();
        isSidebarVisible = !isSidebarVisible;
      });

      sidebarToggle.hover(function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusArrow);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusArrow);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusArrow);
      }, function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusInit);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusInit);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusInit);
      });
    }
  });

</script>





  
  
<script type="text/javascript" id="bootstrap.scrollspy.custom">
  /* ========================================================================
  * Bootstrap: scrollspy.js v3.3.2
  * http://getbootstrap.com/javascript/#scrollspy
  * ========================================================================
  * Copyright 2011-2015 Twitter, Inc.
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
  * ======================================================================== */

  /**
   * Custom by iissnan
   *
   * - Add a `clear.bs.scrollspy` event.
   * - Esacpe targets selector.
   */


  +function ($) {
    'use strict';

    // SCROLLSPY CLASS DEFINITION
    // ==========================

    function ScrollSpy(element, options) {
      this.$body          = $(document.body)
      this.$scrollElement = $(element).is(document.body) ? $(window) : $(element)
      this.options        = $.extend({}, ScrollSpy.DEFAULTS, options)
      this.selector       = (this.options.target || '') + ' .nav li > a'
      this.offsets        = []
      this.targets        = []
      this.activeTarget   = null
      this.scrollHeight   = 0

      this.$scrollElement.on('scroll.bs.scrollspy', $.proxy(this.process, this))
      this.refresh()
      this.process()
    }

    ScrollSpy.VERSION  = '3.3.2'

    ScrollSpy.DEFAULTS = {
      offset: 10
    }

    ScrollSpy.prototype.getScrollHeight = function () {
      return this.$scrollElement[0].scrollHeight || Math.max(this.$body[0].scrollHeight, document.documentElement.scrollHeight)
    }

    ScrollSpy.prototype.refresh = function () {
      var that          = this
      var offsetMethod  = 'offset'
      var offsetBase    = 0

      this.offsets      = []
      this.targets      = []
      this.scrollHeight = this.getScrollHeight()

      if (!$.isWindow(this.$scrollElement[0])) {
        offsetMethod = 'position'
        offsetBase   = this.$scrollElement.scrollTop()
      }

      this.$body
        .find(this.selector)
        .map(function () {
          var $el   = $(this)
          var href  = $el.data('target') || $el.attr('href')
          var $href = /^#./.test(href) && $(escapeSelector(href)) // Need to escape selector.

          return ($href
            && $href.length
            && $href.is(':visible')
            && [[$href[offsetMethod]().top + offsetBase, href]]) || null
        })
        .sort(function (a, b) { return a[0] - b[0] })
        .each(function () {
          that.offsets.push(this[0])
          that.targets.push(this[1])
        })


    }

    ScrollSpy.prototype.process = function () {
      var scrollTop    = this.$scrollElement.scrollTop() + this.options.offset
      var scrollHeight = this.getScrollHeight()
      var maxScroll    = this.options.offset + scrollHeight - this.$scrollElement.height()
      var offsets      = this.offsets
      var targets      = this.targets
      var activeTarget = this.activeTarget
      var i

      if (this.scrollHeight != scrollHeight) {
        this.refresh()
      }

      if (scrollTop >= maxScroll) {
        return activeTarget != (i = targets[targets.length - 1]) && this.activate(i)
      }

      if (activeTarget && scrollTop < offsets[0]) {
        $(this.selector).trigger('clear.bs.scrollspy')  // Add a custom event.
        this.activeTarget = null
        return this.clear()
      }

      for (i = offsets.length; i--;) {
        activeTarget != targets[i]
          && scrollTop >= offsets[i]
          && (!offsets[i + 1] || scrollTop <= offsets[i + 1])
          && this.activate(targets[i])
      }
    }

    ScrollSpy.prototype.activate = function (target) {
      this.activeTarget = target

      this.clear()

      var selector = this.selector +
        '[data-target="' + target + '"],' +
        this.selector + '[href="' + target + '"]'

      var active = $(selector)
        .parents('li')
        .addClass('active')

      if (active.parent('.dropdown-menu').length) {
        active = active
          .closest('li.dropdown')
          .addClass('active')
      }

      active.trigger('activate.bs.scrollspy')
    }

    ScrollSpy.prototype.clear = function () {
      $(this.selector)
        .parentsUntil(this.options.target, '.active')
        .removeClass('active')
    }


    // SCROLLSPY PLUGIN DEFINITION
    // ===========================

    function Plugin(option) {
      return this.each(function () {
        var $this   = $(this)
        var data    = $this.data('bs.scrollspy')
        var options = typeof option == 'object' && option

        if (!data) $this.data('bs.scrollspy', (data = new ScrollSpy(this, options)))
        if (typeof option == 'string') data[option]()
      })
    }

    var old = $.fn.scrollspy

    $.fn.scrollspy             = Plugin
    $.fn.scrollspy.Constructor = ScrollSpy


    // SCROLLSPY NO CONFLICT
    // =====================

    $.fn.scrollspy.noConflict = function () {
      $.fn.scrollspy = old
      return this
    }


    // SCROLLSPY DATA-API
    // ==================

    $(window).on('load.bs.scrollspy.data-api', function () {
      $('[data-spy="scroll"]').each(function () {
        var $spy = $(this)
        Plugin.call($spy, $spy.data())
      })
    })

  }(jQuery);
</script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var $sidebarInner = $('.sidebar-inner');
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.didShow', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;
          var self = this;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      $(indicator).velocity('stop').velocity({
        opacity: action === 'show' ? 0.4 : 0
      }, { duration: 100 });
    }

  });
</script>


  <script type="text/javascript" id="sidebar.nav">
    $(document).ready(function () {
      var html = $('html');

      $('.sidebar-nav li').on('click', function () {
        var item = $(this);
        var activeTabClassName = 'sidebar-nav-active';
        var activePanelClassName = 'sidebar-panel-active';
        if (item.hasClass(activeTabClassName)) {
          return;
        }

        var currentTarget = $('.' + activePanelClassName);
        var target = $('.' + item.data('target'));

        currentTarget.velocity('transition.slideUpOut', 200, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', 200)
            .addClass(activePanelClassName);
        });

        item.siblings().removeClass(activeTabClassName);
        item.addClass(activeTabClassName);
      });

      $('.post-toc a').on('click', function (e) {
        e.preventDefault();
        var offset = $(escapeSelector(this.getAttribute('href'))).offset().top;
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        });
      });

      // Expand sidebar on post detail page by default, when post has a toc.
      if (isDesktop() && HEXO_SIDEBAR_CONFIGURATION === 'post') {
        displaySidebar();
      }
    });
  </script>




   <script type="text/javascript">
    var HEXO_SIDEBAR_CONFIGURATION = 'post';
    $(document).ready(function () {
      if (HEXO_SIDEBAR_CONFIGURATION === 'always') {
        displaySidebar();
      }
    });
  </script>

  

  
  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"phping-github"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  


  
  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?e9c2033659ba96c6e498f134706e150e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>

  

  
  	 <!-- custom analytics part create by xiamo -->
<script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
<script>AV.initialize("3GRc1LQlBghhSKT0zcwLUM6W-gzGzoHsz", "v75BUg0RnRqBDdzft0w76rpX");</script>
<script>
function showTime(Counter) {
	var query = new AV.Query(Counter);
	$(".leancloud_visitors").each(function() {
		var url = $(this).attr("id").trim();
		query.equalTo("url", url);
		query.find({
			success: function(results) {
				if (results.length == 0) {
					var content = $(document.getElementById(url)).text() + ': 0';
					$(document.getElementById(url)).text(content);
					return;
				}
				for (var i = 0; i < results.length; i++) {
					var object = results[i];
					var content = $(document.getElementById(url)).text() + ': ' + object.get('time');
					$(document.getElementById(url)).text(content);
				}
			},
			error: function(object, error) {
				console.log("Error: " + error.code + " " + error.message);
			}
		});

	});
}

function addCount(Counter) {
	var Counter = AV.Object.extend("Counter");
	url = $(".leancloud_visitors").attr('id').trim();
	title = $(".leancloud_visitors").attr('data-flag-title').trim();
	var query = new AV.Query(Counter);
	query.equalTo("url", url);
	query.find({
		success: function(results) {
			if (results.length > 0) {
				var counter = results[0];
				counter.fetchWhenSave(true);
				counter.increment("time");
				counter.save(null, {
					success: function(counter) {
						var content = $(document.getElementById(url)).text() + ': ' + counter.get('time');
						$(document.getElementById(url)).text(content);
					},
					error: function(counter, error) {
						console.log('Failed to save Visitor num, with error message: ' + error.message);
					}
				});
			} else {
				var newcounter = new Counter();
				newcounter.set("title", title);
				newcounter.set("url", url);
				newcounter.set("time", 1);
				newcounter.save(null, {
					success: function(newcounter) {
					    console.log("newcounter.get('time')="+newcounter.get('time'));
						var content = $(document.getElementById(url)).text() + ': ' + newcounter.get('time');
						$(document.getElementById(url)).text(content);
					},
					error: function(newcounter, error) {
						console.log('Failed to create');
					}
				});
			}
		},
		error: function(error) {
			console.log('Error:' + error.code + " " + error.message);
		}
	});
}
$(function() {
	var Counter = AV.Object.extend("Counter");
	if ($('.leancloud_visitors').length == 1) {
		addCount(Counter);
	} else if ($('.post-title-link').length > 1) {
		showTime(Counter);
	}
});
</script>

  
</body>
</html>
<a href="https://github.com/phping1"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/121cd7cbdc3e4855075ea8b558508b91ac463ac2/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_green_007200.png"></a>
